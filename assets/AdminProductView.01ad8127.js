import{p as Y,s as G,r as S,a as p,o as c,c as m,w as o,Q as H,aY as k,S as g,d as n,e as a,q as v,i,t as z,v as _,z as J,f as w,g as Q,m as u,y as f,L as q,M as K,N as W,k as X,j as P,b6 as B}from"./index.f06b7b42.js";import{Q as Z}from"./QAvatar.6bbd8e24.js";import{Q as $}from"./QTd.a34e9923.js";import{Q as ee}from"./QResponsive.b5b9761f.js";import{Q as j}from"./QCard.33016e7a.js";import{Q as te,a as se,b as D}from"./QTable.a802d648.js";import{Q as le}from"./QFile.09f6a88f.js";import{u as ae}from"./use-quasar.2eb90673.js";const oe={id:"myheader",class:"row justify-end items-center",style:{width:"100%"}},ne=u(" \u56DE\u524D\u53F0 "),ie=u(" \u767B\u51FA "),re={id:"mycontent",class:""},de={class:"row justify-between"},ce=n("div",{class:"col-auto text-h3 text-secondary q-my-sm q-pl-md"},"\u5546\u54C1\u7BA1\u7406",-1),ue=u("\u65B0\u589E\u5546\u54C1"),me={class:"q-pa-md"},fe=["src"],pe={class:"row justify-center"},ge=u("\u4FEE\u6539\u5546\u54C1"),_e=u("\u522A\u9664\u5546\u54C1 "),xe={class:"full-width row flex-center text-accent q-gutter-sm"},ye={class:"col-12 col-sm-6 col-md-4 col-lg-3 q-pa-sm cursor-pointer"},be=["src"],he={key:1,class:"text-left q-mx-auto"},ke={class:"row justify-between"},ve={class:"text-accent"},we={class:"text-secondary text-right"},qe={key:2,class:"text-left q-mx-auto"},Ve={class:"row justify-between"},Ce={class:"text-accent"},Qe=u("\u4FEE\u6539\u5546\u54C1"),Pe={class:"row justify-end q-mt-sm"},$e=u("\u522A\u9664\u5546\u54C1"),je=n("p",{class:"text-h6 text-dark"},"\u5546\u54C1\u540D\u7A31",-1),Ue=n("p",{class:"text-h6 text-dark"},"\u5546\u54C1\u63CF\u8FF0",-1),Le={class:"row q-mb-sm"},Ne={class:"column col-6"},Se=n("div",{class:"col-6 text-h6 text-dark"},"\u5EAB\u5B58\u72C0\u614B",-1),ze={class:"column col-6"},Be=n("div",{class:"col-6 text-h6 text-dark"},"\u4E0A\u67B6\u72C0\u614B",-1),De=n("p",{class:"text-h6 text-dark"},"\u5546\u54C1\u50F9\u683C",-1),Fe=n("p",{class:"text-h6 text-dark"},"\u5546\u54C1\u5716\u7247",-1),Te={class:"row justify-around"},Ae=n("div",{class:"col-12 text-center text-h3 text-red q-pb-md"},"\u8B66\u544A",-1),Ie={class:"col-12 text-center text-h6 text-dark q-pb-md"},Ee=n("br",null,null,-1),Me={class:"col-12 row justify-around"},Ze={__name:"AdminProductView",setup(Re){const U=Y(),{logout:F}=U,{isLogin:L}=G(U),V=S(""),T=ae(),A=S(!1),d=p([]),I=p({items:[],page:1,rowsPerPage:5}),s=p({_id:"",name:"",description:"",inventory:!1,sell:!1,price:0,image:[],idx:-1,dialog:!1}),x=p({required(l){return!!l||"\u5FC5\u586B\u6B04\u4F4D"},price(l){return l>-1||"\u50F9\u683C\u5FC5\u9808\u5927\u65BC\u6216\u7B49\u65BC 0"},size(l){var e,t,r;return!l||!l.length||((t=(e=l[0])==null?void 0:e.type)==null?void 0:t.includes("image"))&&((r=l[0])==null?void 0:r.size)<=1024*1024*2||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26\uFF08\u9808\u70BA\u5716\u7247\u6A94\uFF0C\u4E14\u6A94\u6848\u5927\u5C0F 2 MB \u4EE5\u4E0B\uFF09"}}),E=async()=>{const l=new FormData;for(const e in s)if(!["_id","idx","dialog"].includes(e))if(e==="image")for(const t of s.image)l.append(e,t);else l.append(e,s[e]);try{if(s._id.length===0){const{data:e}=await k.post("/products",l);d.push(e.result),g.fire({icon:"success",title:"\u65B0\u589E\u6210\u529F",text:"\u60A8\u5DF2\u6210\u529F\u65B0\u589E\u4E00\u7B46\u5546\u54C1\uFF01"}),h()}else{const{data:e}=await k.patch("/products/"+s._id,l);d[s.idx]=e.result,g.fire({icon:"success",title:"\u4FEE\u6539\u6210\u529F",text:"\u60A8\u5DF2\u6210\u529F\u4FEE\u6539\u8A72\u7B46\u5546\u54C1\uFF01"}),h()}s.dialog=!1}catch(e){g.fire({icon:"error",title:"\u65B0\u589E\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}},y=p({dialog:!1}),b=p({_id:"",name:""}),N=(l,e)=>{b._id=l,b.name=e,y.dialog=!0},M=async l=>{y.dialog=!1;try{await k.delete("/products/"+l),await g.fire({icon:"success",title:"\u522A\u9664\u6210\u529F",text:"\u60A8\u5DF2\u6210\u529F\u522A\u9664\u8A72\u7B46\u5546\u54C1\uFF01"}),h()}catch(e){g.fire({icon:"error",title:"\u522A\u9664\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}},C=(l,e)=>{s._id=l,e>-1?(s.name=d[e].name,s.description=d[e].description,s.inventory=d[e].inventory,s.sell=d[e].sell,s.price=d[e].price):(s.name="",s.description="",s.inventory=!1,s.sell=!1,s.price=0),s.image=[],s.idx=e,s.dialog=!0},R=[{name:"image",label:"\u5546\u54C1\u5716\u7247",align:"center",field:l=>l.image[0]},{name:"name",label:"\u5546\u54C1\u540D\u7A31",field:l=>l.name,format:l=>`${l}`,required:!0,align:"center",sortable:!0},{name:"inventory",label:"\u5EAB\u5B58\u72C0\u614B",field:l=>l.inventory?"\u6709\u73FE\u8CA8":"\u9700\u9810\u8A02",align:"center",sortable:!0},{name:"sell",label:"\u4E0A\u67B6\u72C0\u614B",field:l=>l.sell?"\u4E0A\u67B6":"\u4E0B\u67B6",align:"center",sortable:!0},{name:"price",label:"\u5546\u54C1\u50F9\u683C",field:l=>l.price,align:"center",sortable:!0},{name:"edit",label:"\u5546\u54C1\u7DE8\u8F2F",align:"center"}],h=async()=>{try{const{data:l}=await k.get("/products/all");d.splice(0,d.length),d.push(...l.result),d.reverse()}catch(l){g.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}};return h(),(l,e)=>(c(),m(H,{class:"column"},{default:o(()=>[n("div",oe,[a(J,{class:"text-h5 text-secondary mobile-none"},{default:o(()=>[v(L)?(c(),m(i,{key:0,round:"",dense:"",flat:"",icon:"fa-solid fa-house",to:"/",class:"q-mx-xs"},{default:o(()=>[a(z,{"transition-show":"fade","transition-hide":"fade",offset:[0,0]},{default:o(()=>[ne]),_:1})]),_:1})):_("",!0),v(L)?(c(),m(i,{key:1,round:"",dense:"",flat:"",icon:"fa-solid fa-right-from-bracket",onClick:v(F),class:"q-ml-xl q-mr-lg"},{default:o(()=>[a(z,{"transition-show":"fade","transition-hide":"fade",offset:[0,0]},{default:o(()=>[ie]),_:1})]),_:1},8,["onClick"])):_("",!0)]),_:1})]),n("div",re,[n("div",de,[ce,a(i,{onClick:e[0]||(e[0]=t=>C("",-1)),square:"",flat:"",class:"col-auto q-mr-xl bg-secondary text-dark text-h6 q-my-sm createBtn"},{default:o(()=>[ue]),_:1})]),n("div",me,[a(se,{grid:v(T).screen.lt.xl,columns:R,rows:d,"row-key":"name",square:"",bordered:"","wrap-cells":"","binary-state-sort":"",dense:"",filter:V.value,loading:A.value,pagination:I,"rows-per-page-label":"\u6BCF\u9801\u986F\u793A\u7B46\u6578","no-data-label":"\u76EE\u524D\u6C92\u6709\u65B0\u589E\u4EFB\u4F55\u5546\u54C1","no-results-label":"Oops...\u627E\u4E0D\u5230\u8A72\u7B46\u5546\u54C1"},{"top-right":o(()=>[a(w,{borderless:"",dense:"",debounce:"300",modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),placeholder:"\xA0Search",class:"search"},{append:o(()=>[a(Q,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-image":o(t=>[a($,{img:t,align:"center",ellipsis:""},{default:o(()=>[a(Z,{square:"",size:"100px"},{default:o(()=>[n("img",{src:t.row.image,class:"q-mb-xl",style:{"object-fit":"cover"}},null,8,fe)]),_:2},1024)]),_:2},1032,["img"])]),"body-cell-price":o(t=>[a($,{img:t,align:"center"},{default:o(()=>[u(" NT$ "+f(t.row.price.toLocaleString()),1)]),_:2},1032,["img"])]),"body-cell-edit":o(t=>[a($,{edit:t},{default:o(()=>[n("div",pe,[a(i,{class:"col-auto q-mx-sm q-my-xs",onClick:r=>C(t.row._id,t.rowIndex),outline:""},{default:o(()=>[ge]),_:2},1032,["onClick"]),a(i,{class:"col-auto q-mx-sm q-my-xs",onClick:r=>N(t.row._id,t.row.name),outline:""},{default:o(()=>[_e]),_:2},1032,["onClick"])])]),_:2},1032,["edit"])]),pagination:o(t=>[t.pagesNumber>1?(c(),m(i,{key:0,icon:"first_page",color:"secondary",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.firstPage},null,8,["disable","onClick"])):_("",!0),a(i,{icon:"chevron_left",color:"secondary",round:"",dense:"",flat:"",disable:t.isFirstPage,onClick:t.prevPage},null,8,["disable","onClick"]),a(i,{icon:"chevron_right",color:"secondary",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.nextPage},null,8,["disable","onClick"]),t.pagesNumber>1?(c(),m(i,{key:1,icon:"last_page",color:"secondary",round:"",dense:"",flat:"",disable:t.isLastPage,onClick:t.lastPage},null,8,["disable","onClick"])):_("",!0)]),"no-data":o(({message:t})=>[n("div",xe,[n("span",null,f(t),1)])]),item:o(t=>[n("div",ye,[a(j,{square:"",bordered:"",class:"bg-primary shadow"},{default:o(()=>[(c(!0),q(W,null,K(t.cols,r=>(c(),q("div",{key:r.name,class:"q-pa-sm"},[r.name=="image"?(c(),m(ee,{key:0,ratio:3/2},{default:o(()=>[n("img",{src:t.row[r.name],class:"col",style:{width:"100%"}},null,8,be)]),_:2},1024)):r.name!=="image"&&r.name!=="edit"?(c(),q("div",he,[n("div",ke,[n("span",ve,f(r.label)+"\uFF1A",1),n("span",we,f(r.value),1)])])):r.name==="edit"?(c(),q("div",qe,[n("div",Ve,[n("span",Ce,f(r.label)+"\uFF1A",1),a(i,{class:"col-auto text-secondary",style:{"font-size":"xx-small",padding:"0px 8px"},onClick:O=>C(t.row._id,t.rowIndex),outline:""},{default:o(()=>[Qe]),_:2},1032,["onClick"])]),n("div",Pe,[a(i,{class:"col-auto text-secondary",style:{"font-size":"xx-small",padding:"0px 8px"},onClick:O=>N(t.row._id,t.row.name),outline:""},{default:o(()=>[$e]),_:2},1032,["onClick"])])])):_("",!0)]))),128))]),_:2},1024)])]),loading:o(()=>[a(te,{showing:"",dark:"","transition-show":"fade",color:"primary"})]),_:1},8,["grid","rows","filter","loading","pagination"])]),a(D,{modelValue:s.dialog,"onUpdate:modelValue":e[11]||(e[11]=t=>s.dialog=t),seamless:""},{default:o(()=>[s.dialog?(c(),m(j,{key:0,id:"dialog",flat:"",square:"",bordered:"",persistent:"",class:"bg-info text-secondary shadow-white"},{default:o(()=>[a(X,{onSubmit:P(E,["prevent"]),class:"q-pa-md"},{default:o(()=>[je,a(w,{modelValue:s.name,"onUpdate:modelValue":e[2]||(e[2]=t=>s.name=t),rules:[x.required],type:"text",outlined:"",square:"",dense:""},null,8,["modelValue","rules"]),Ue,a(w,{modelValue:s.description,"onUpdate:modelValue":e[3]||(e[3]=t=>s.description=t),rules:[x.required],type:"textarea",outlined:"",square:"",dense:""},null,8,["modelValue","rules"]),n("div",Le,[n("div",Ne,[Se,a(B,{class:"col-6 text-dark",modelValue:s.inventory,"onUpdate:modelValue":e[4]||(e[4]=t=>s.inventory=t),label:s.inventory?"\u6709\u73FE\u8CA8":"\u6C92\u73FE\u8CA8"},null,8,["modelValue","label"])]),n("div",ze,[Be,a(B,{class:"col-6 text-dark",modelValue:s.sell,"onUpdate:modelValue":e[5]||(e[5]=t=>s.sell=t),label:s.sell?"\u4E0A\u67B6":"\u4E0B\u67B6"},null,8,["modelValue","label"])])]),De,a(w,{modelValue:s.price,"onUpdate:modelValue":e[6]||(e[6]=t=>s.price=t),modelModifiers:{number:!0},min:"0",rules:[x.required,x.price],outlined:"",square:"",dense:"",class:"text-primary"},null,8,["modelValue","rules"]),Fe,a(le,{modelValue:s.image,"onUpdate:modelValue":e[9]||(e[9]=t=>s.image=t),multiple:"",rules:[x.size],accept:"image/*",filled:"","bottom-slots":"",counter:""},{prepend:o(()=>[a(Q,{name:"cloud_upload",onClick:e[7]||(e[7]=P(()=>{},["stop","prevent"]))})]),append:o(()=>[a(Q,{name:"close",onClick:e[8]||(e[8]=P(t=>l.model=null,["stop","prevent"])),class:"cursor-pointer"})]),hint:o(()=>[]),_:1},8,["modelValue","rules"]),n("div",Te,[a(i,{square:"",flat:"",type:"submit",class:"col-4 bg-secondary text-dark q-my-sm",label:"\u9001\u51FA\u7DE8\u8F2F"}),a(i,{square:"",flat:"",outline:"",class:"col-4 bg-dark text-secondary q-my-sm",label:"\u53D6\u6D88",onClick:e[10]||(e[10]=t=>s.dialog=!1)})])]),_:1},8,["onSubmit"])]),_:1})):_("",!0)]),_:1},8,["modelValue"]),a(D,{modelValue:y.dialog,"onUpdate:modelValue":e[14]||(e[14]=t=>y.dialog=t),seamless:"",persistent:""},{default:o(()=>[a(j,{square:"",class:"row justify-center bg-info q-pa-lg"},{default:o(()=>[Ae,n("div",Ie,[u("\u4F60\u78BA\u5B9A\u8981\u522A\u9664\u3010"+f(b.name)+"\u3011\u5546\u54C1\u55CE\uFF1F",1),Ee,u("\u522A\u9664\u3010"+f(b.name)+"\u3011\u5546\u54C1\u5C07\u7121\u6CD5\u5FA9\u539F\uFF01",1)]),n("div",Me,[a(i,{onClick:e[12]||(e[12]=t=>M(b._id)),square:"",flat:"",class:"col-4 bg-secondary text-dark q-my-sm",label:"\u78BA\u5B9A\u522A\u9664\u5546\u54C1"}),a(i,{square:"",flat:"",outline:"",class:"col-4 bg-dark text-secondary q-my-sm",label:"\u53D6\u6D88",onClick:e[13]||(e[13]=t=>y.dialog=!1)})])]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};export{Ze as default};
